<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Document Simplifier</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        html { scroll-behavior: smooth; }
        body { font-family: 'Inter', sans-serif; }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #chat-history::-webkit-scrollbar { width: 8px; }
        #chat-history::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        #chat-history::-webkit-scrollbar-thumb { background: #888; border-radius: 10px; }
        #chat-history::-webkit-scrollbar-thumb:hover { background: #555; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 antialiased">

    <nav class="bg-white shadow-sm sticky top-0 z-10">
        <div class="container mx-auto px-4 md:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="text-2xl font-bold text-gray-900">
                    <a href="#">AI Legitimo</a>
                </div>
                <div class="flex items-center space-x-6 text-sm font-medium">
                    <a href="#" class="text-gray-600 hover:text-blue-600 transition duration-150 ease-in-out">About</a>
                    <a href="#features" class="text-gray-600 hover:text-blue-600 transition duration-150 ease-in-out">Feature</a>
                    <span class="text-gray-400 cursor-not-allowed">Pricing</span>
                    <div class="text-gray-400 cursor-not-allowed" title="Profile">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 M11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        <header class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-900">AI Document Simplifier</h1>
            <p class="text-gray-600 mt-2">Upload a document for analysis, GCS upload, BigQuery logging, and interactive chat.</p>
        </header>

        <main class="bg-white rounded-2xl shadow-xl p-6 md:p-8 space-y-8 mb-8">
            <!-- Upload Section -->
            <div>
                <h2 class="text-xl font-semibold mb-4 border-b pb-2">Upload & Analyze Document</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-center">
                    <div>
                        <label for="file-upload" class="block text-sm font-medium text-gray-700">Document File</label>
                        <input type="file" id="file-upload" class="mt-1 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 cursor-pointer" accept=".pdf,.docx,.txt,.png,.jpg,.jpeg">
                         <p class="text-xs text-gray-500 mt-1">Supports: PDF, DOCX, TXT, PNG, JPG.</p>
                    </div>
                    <div>
                        <label for="language-select" class="block text-sm font-medium text-gray-700">Language for Analysis</label>
                        <select id="language-select" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 sm:text-sm rounded-lg bg-gray-50">
                            <option value="English">English</option>
                            <option value="Hindi">Hindi (‡§π‡§ø‡§®‡•ç‡§¶‡•Ä)</option>
                            <option value="Kannada">Kannada (‡≤ï‡≤®‡≥ç‡≤®‡≤°)</option>
                        </select>
                    </div>
                </div>
                <div class="mt-6 text-center">
                    <button id="analyze-btn" class="w-full md:w-auto bg-blue-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition duration-300 ease-in-out transform hover:scale-105 disabled:bg-gray-400 disabled:cursor-not-allowed disabled:transform-none flex items-center justify-center mx-auto">
                        <span id="analyze-btn-text">Analyze Document</span>
                        <div id="analyze-loader" class="loader hidden ml-3"></div>
                    </button>
                </div>
            </div>

            <!-- Analysis Output Section -->
            <div id="analysis-output" class="hidden">
                 <h2 class="text-xl font-semibold mb-4 border-b pb-2">Document Analysis</h2>
                 <div id="analysis-content" class="prose max-w-none text-gray-700 bg-gray-50 p-4 rounded-lg"></div>
            </div>

            <!-- Chat Section -->
            <div id="chat-section" class="hidden">
                 <h2 class="text-xl font-semibold mb-4 border-b pb-2">Ask Follow-up Questions</h2>
                <div class="border border-gray-200 rounded-lg overflow-hidden">
                    <div id="chat-history" class="h-80 overflow-y-auto p-4 space-y-4 bg-gray-50"></div>
                    <div class="p-4 border-t border-gray-200 bg-white flex items-center">
                        <input type="text" id="chat-input" placeholder="Type your question..." class="flex-grow px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <button id="send-btn" class="ml-4 bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-300 transition duration-300 ease-in-out disabled:bg-gray-400">Send</button>
                    </div>
                </div>
            </div>
            
            <!-- Status/Error Box -->
            <div id="status-box" class="hidden px-4 py-3 rounded-lg relative" role="alert">
                <strong class="font-bold" id="status-title"></strong>
                <span class="block sm:inline" id="status-message"></span>
            </div>
        </main>
        
        <!-- Features Section -->
        <section id="features" class="bg-white rounded-2xl shadow-xl p-6 md:p-8">
            <div class="text-center">
                <h2 class="text-3xl font-bold text-gray-900">Key Features</h2>
                <p class="text-gray-600 mt-2">Discover what makes AI Legitimo powerful and easy to use.</p>
            </div>
            <div class="mt-10 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Feature 1: Multi-Format Support -->
                <div class="p-6 border border-gray-200 rounded-xl text-center transition-all duration-300 hover:shadow-lg hover:border-blue-500">
                    <div class="flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 text-blue-600 mx-auto">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                    </div>
                    <h3 class="text-lg font-semibold mt-4 text-gray-900">Multi-Format Support</h3>
                    <p class="text-gray-600 mt-2 text-sm">Analyze various document types including PDF, DOCX, TXT, and even images like PNG and JPG.</p>
                </div>
                <!-- Feature 2: Secure Cloud Integration -->
                <div class="p-6 border border-gray-200 rounded-xl text-center transition-all duration-300 hover:shadow-lg hover:border-blue-500">
                    <div class="flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 text-blue-600 mx-auto">
                       <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z" /></svg>
                    </div>
                    <h3 class="text-lg font-semibold mt-4 text-gray-900">Secure Cloud Integration</h3>
                    <p class="text-gray-600 mt-2 text-sm">Seamlessly uploads your documents to Google Cloud Storage and logs metadata in BigQuery for robust tracking.</p>
                </div>
                <!-- Feature 3: Advanced AI Analysis -->
                <div class="p-6 border border-gray-200 rounded-xl text-center transition-all duration-300 hover:shadow-lg hover:border-blue-500">
                    <div class="flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 text-blue-600 mx-auto">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>
                    </div>
                    <h3 class="text-lg font-semibold mt-4 text-gray-900">Advanced AI Analysis</h3>
                    <p class="text-gray-600 mt-2 text-sm">Powered by Google's Gemini, get structured summaries, risk analysis, and identify key clauses in your documents.</p>
                </div>
                 <!-- Feature 4: Interactive Chat -->
                <div class="p-6 border border-gray-200 rounded-xl text-center transition-all duration-300 hover:shadow-lg hover:border-blue-500">
                    <div class="flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 text-blue-600 mx-auto">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" /></svg>
                    </div>
                    <h3 class="text-lg font-semibold mt-4 text-gray-900">Interactive Chat</h3>
                    <p class="text-gray-600 mt-2 text-sm">Ask follow-up questions and get instant, context-aware answers about your document from the AI assistant.</p>
                </div>
                 <!-- Feature 5: Multilingual Support -->
                <div class="p-6 border border-gray-200 rounded-xl text-center transition-all duration-300 hover:shadow-lg hover:border-blue-500">
                    <div class="flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 text-blue-600 mx-auto">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 5h12M9 3v2m4.05 16.5l-3.05-3.05a3 3 0 00-4.242 0l-3.05 3.05M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                    </div>
                    <h3 class="text-lg font-semibold mt-4 text-gray-900">Multilingual Support</h3>
                    <p class="text-gray-600 mt-2 text-sm">Get your document analysis and chat with the AI in multiple languages including English, Hindi, and Kannada.</p>
                </div>
                 <!-- Feature 6: OCR for Images -->
                <div class="p-6 border border-gray-200 rounded-xl text-center transition-all duration-300 hover:shadow-lg hover:border-blue-500">
                    <div class="flex items-center justify-center h-12 w-12 rounded-full bg-blue-100 text-blue-600 mx-auto">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path stroke-linecap="round" stroke-linejoin="round" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>
                    </div>
                    <h3 class="text-lg font-semibold mt-4 text-gray-900">OCR for Images</h3>
                    <p class="text-gray-600 mt-2 text-sm">Powered by Google Vision API, text is automatically extracted from your scanned documents or images.</p>
                </div>
            </div>
        </section>

    </div>

    <footer class="bg-white mt-12">
        <div class="container mx-auto px-4 md:px-8 py-8">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="text-center md:text-left mb-4 md:mb-0">
                    <p class="text-sm text-gray-600">&copy; 2025 AI Legitimo. All rights reserved.</p>
                    <p class="text-xs text-gray-500 mt-1">Simplifying legal documents with the power of AI.</p>
                </div>
                <div class="flex space-x-4">
                    <a href="#" class="text-gray-500 hover:text-blue-600">
                        <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z" clip-rule="evenodd" /></svg>
                    </a>
                    <a href="#" class="text-gray-500 hover:text-blue-600">
                        <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.71v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84" /></svg>
                    </a>
                    <a href="#" class="text-gray-500 hover:text-blue-600">
                         <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M12 2C6.477 2 2 6.477 2 12.019c0 4.435 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.009-.868-.014-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.031-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.203 2.398.1 2.651.64.7 1.03 1.595 1.03 2.688 0 3.848-2.338 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.001 10.001 0 0022 12.019C22 6.477 17.523 2 12 2z" clip-rule="evenodd" /></svg>
                    </a>
                </div>
            </div>
        </div>
    </footer>


    <script>
        // --- DOM Elements ---
        const fileUpload = document.getElementById('file-upload');
        const languageSelect = document.getElementById('language-select');
        const analyzeBtn = document.getElementById('analyze-btn');
        const analyzeBtnText = document.getElementById('analyze-btn-text');
        const analyzeLoader = document.getElementById('analyze-loader');
        const analysisOutput = document.getElementById('analysis-output');
        const analysisContent = document.getElementById('analysis-content');
        const chatSection = document.getElementById('chat-section');
        const chatHistory = document.getElementById('chat-history');
        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        const statusBox = document.getElementById('status-box');
        const statusTitle = document.getElementById('status-title');
        const statusMessage = document.getElementById('status-message');

        let chatHistoryArray = [];
        const FLASK_BACKEND_URL = '/api'; // URL of your local Flask server

        // --- Event Listeners ---
        analyzeBtn.addEventListener('click', handleAnalysis);
        sendBtn.addEventListener('click', handleChatMessage);
        chatInput.addEventListener('keyup', (event) => {
            if (event.key === 'Enter') handleChatMessage();
        });

        // --- Main Functions ---

        async function handleAnalysis() {
            const file = fileUpload.files[0];
            if (!file) {
                showStatus("Input Error", "Please select a file to analyze.", 'error');
                return;
            }
            
            hideStatus();
            setLoading(true, analyzeBtn, analyzeBtnText, analyzeLoader);
            
            analysisOutput.classList.add('hidden');
            chatSection.classList.add('hidden');
            chatHistory.innerHTML = '';
            
            const formData = new FormData();
            formData.append('file', file);
            formData.append('language', languageSelect.value);

            try {
                showStatus("Processing...", "Uploading file and running analysis. This may take a moment.", "info");
                const response = await fetch(`${FLASK_BACKEND_URL}/analyze`, {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (!response.ok) {
                    throw new Error(result.error || `HTTP error! Status: ${response.status}`);
                }

                analysisContent.innerHTML = formatResponse(result.analysis);
                analysisOutput.classList.remove('hidden');
                chatSection.classList.remove('hidden');
                hideStatus();

                chatHistoryArray = [
                    { role: "user", parts: [{ text: `Here is the document context: ${result.documentText}` }] },
                    { role: "model", parts: [{ text: result.analysis }] }
                ];
                addMessageToHistory("ü§ñ AI Assistant", "Hello! I've analyzed your document. How can I help you further?", 'ai');

            } catch (error) {
                console.error("Analysis Error:", error);
                showStatus("Analysis Failed", error.message, 'error');
            } finally {
                setLoading(false, analyzeBtn, analyzeBtnText, analyzeLoader);
            }
        }

        async function handleChatMessage() {
            const userQuestion = chatInput.value.trim();
            if (!userQuestion) return;

            addMessageToHistory("üë§ You", userQuestion, 'user');
            chatInput.value = '';
            setLoading(true, sendBtn);

            chatHistoryArray.push({ role: "user", parts: [{ text: userQuestion }] });

            try {
                const response = await fetch(`${FLASK_BACKEND_URL}/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        history: chatHistoryArray,
                        language: languageSelect.value
                    })
                });
                
                const result = await response.json();
                if (!response.ok) {
                    throw new Error(result.error || 'Failed to get chat response.');
                }

                const aiResponse = result.response;
                chatHistoryArray.push({ role: "model", parts: [{ text: aiResponse }] });
                addMessageToHistory("ü§ñ AI Assistant", aiResponse, 'ai');

            } catch (error) {
                 console.error("Chat Error:", error);
                 addMessageToHistory("ü§ñ AI Assistant", `Sorry, I encountered an error: ${error.message}`, 'ai-error');
            } finally {
                setLoading(false, sendBtn);
            }
        }

        // --- UI Helper Functions ---
        function formatResponse(text) {
             return text
                .replace(/### (.*?)\n/g, '<h3 class="text-lg font-semibold mt-4 mb-2">$1</h3>')
                .replace(/\n/g, '<br>');
        }

        function addMessageToHistory(sender, message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('p-3', 'rounded-lg', 'max-w-xl');
            let contentDiv = document.createElement('div');
            contentDiv.innerHTML = `<strong>${sender}</strong><br>${formatResponse(message)}`;

            if (type === 'user') {
                messageDiv.classList.add('bg-blue-100', 'text-blue-900', 'self-end', 'ml-auto');
            } else {
                messageDiv.classList.add('bg-gray-200', 'text-gray-900', 'self-start', 'mr-auto');
                if (type === 'ai-error') {
                    messageDiv.classList.replace('bg-gray-200', 'bg-red-100');
                    messageDiv.classList.replace('text-gray-900', 'text-red-900');
                }
            }
            messageDiv.appendChild(contentDiv);
            chatHistory.appendChild(messageDiv);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        function setLoading(isLoading, button, textElement, loaderElement) {
            button.disabled = isLoading;
            if (textElement) textElement.style.display = isLoading ? 'none' : 'inline';
            if (loaderElement) loaderElement.style.display = isLoading ? 'block' : 'none';
        }

        function showStatus(title, message, type) {
            statusTitle.textContent = title;
            statusMessage.textContent = message;
            statusBox.className = 'px-4 py-3 rounded-lg relative'; // Reset classes
            if(type === 'error') statusBox.classList.add('bg-red-100', 'border', 'border-red-400', 'text-red-700');
            else statusBox.classList.add('bg-blue-100', 'border', 'border-blue-400', 'text-blue-700');
            statusBox.classList.remove('hidden');
        }

        function hideStatus() {
            statusBox.classList.add('hidden');
        }
    </script>
</body>
</html>
